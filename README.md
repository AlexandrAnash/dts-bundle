# dts-bundle

[![Build Status](https://secure.travis-ci.org/grunt-ts/dts-bundle.svg?branch=master)](http://travis-ci.org/grunt-ts/dts-bundle) [![NPM version](https://badge.fury.io/js/dts-bundle.svg)](http://badge.fury.io/js/dts-bundle) [![Dependency Status](https://david-dm.org/grunt-ts/dts-bundle.svg)](https://david-dm.org/grunt-ts/dts-bundle) [![devDependency Status](https://david-dm.org/grunt-ts/dts-bundle/dev-status.svg)](https://david-dm.org/grunt-ts/dts-bundle#info=devDependencies)

> Export TypeScript .d.ts files as an external module definition

This module is a na√Øve string-based approach at generating bundles from the .d.ts declaration files generated by a TypeScript compiler.

The main use-case is generating definition for npm/bower modules written in TypeScript (commonjs/amd).

Source-code should following the external-module pattern (using `import/export`'s and `--outDir`).

:warning: Experimental; use with care.

This module was born out of necessity and frustration. It is a little hacky, but at least if seems to work..

- original code was extracted from an ad-hoc Grunt-task so it is fully synchronous without feedback (except maybe some thrown assertion Error's if you feed it garbage input).
- it works by line-by-line string operations so who knows what kind of funky edge-cases it burns (leave an issue if you find some).


## Usage

1) Get it from npm:

````
npm install dts-bundle
````

2) Compile your modules with the TypeScript compiler of your choice with the `--declaration` and `--outDir` flags (and probably `--module commonjs` too).

3) Run `dts-bundle`

Let's assume the project is called `cool-project` and the main module is `build/index.js` with a `build/index.d.ts`:

````js
var dts = require('dts-bundle');

dts.bundle({
    name: 'cool-project',
    main: 'build/index.d.ts'
});
````

This will traverse all references and imports for the .d.ts files of your sub-modules.

Then it writes `build/cool-project.d.ts` with the bundle of all 'local' imports.

4) Extra bonus points if you link the generated definition in your package.json (or bower.json), in the typescript element:

````json
{
    "name": "cool-project",
    "version": "0.1.3"

    "typescript": {
        "definition": "build/cool-project.d.ts"
    }
}
````

Using this makes the definition findable for tooling, for example the [TypeScript Definitions package manager](https://github.com/DefinitelyTyped/tsd) (from v0.6.x) can auto-link these into it `tsd.d.ts` bundle file (wow, so convenient).

## Options

Here is a list of all options, with their defaults:

````js
var opts = {
    // Required
    name: undefined, // Name of module (i.e. declare module "<name>")
    main: undefined, // Relative or absolute path to entry-point, e.g. "lib/index.d.ts"

    // Optional
    verbose: false, // Enable verbose mode, prints detailed info about all references it finds and includes/excludes
    baseDir: path.dirname(opts.main), // Base directory to be used for discovering 'source typings', i.e. typings that belong to your project, defaults to directory where main is found
    out: opts.name + '.d.ts', // Path of output file, defaults to "<baseDir>/<name>.d.ts"
    includeExternal: false, // Whether to include typings that were found outside of the 'source typings' (typically stuff like node.d.ts)
    excludeTypingsExp: new RegExp('^' + regexEscape(out) + '$'), // RegEx to completely exclude typings from consideration (used to match a path relative to opts.baseDir, note: always use forward-slashes in it, even on Windows)
    deleteSourceTypings: false, // Whether to delete all source typings (i.e. "<baseDir>/**/*.d.ts")
    newline: os.EOL, // Newline to use in output file
    indent: '    ', // Indentation to use in output file
    prefix: '__', // Prefix for rewriting module names
    separator: '/', // Separator for rewriting module names
};

var dts = require('dts-bundle');
dts.bundle(opts);
````

## Todo

- add feature to create a DefinitelyTyped header (using `definition-header` package)
- add feature to auto-update package.json/bower.json with the definition link
- find time to implement a real, parser based solution


## Contributions

They are very welcome. Beware this module is a quick hack-job so good luck!

* Martin Poelstra (@poelstra): Exclude 'external' typings (such as node.d.ts) by default, fixed hang bug, optional debug output, more configurability.

## License

Copyright (c) 2014 [Bart van der Schoor](https://github.com/Bartvds)

Licensed under the MIT license.
